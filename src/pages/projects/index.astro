---
import Layout from "../../layouts/Layout.astro";
import ProjectFilter from "../../components/islands/ProjectFilter";
import { getCollection } from "astro:content";

const projects = await getCollection("projects");
const sortedProjects = projects.sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
import { getImage } from "astro:assets";

const optimizedProjects = await Promise.all(
	sortedProjects.map(async (project) => {
		let heroImageSrc = undefined;
		if (project.data.heroImage) {
			const optimized = await getImage({
				src: project.data.heroImage,
				format: "webp",
				width: 800,
			});
			heroImageSrc = optimized.src;
		}
		return {
			...project,
			data: {
				...project.data,
				heroImage: heroImageSrc,
			},
		};
	}),
);
---

<Layout
	title="Projects | Engineering & Code"
	description="My projects and case studies."
>
	<div class="w-full px-4">
		<header class="mb-12 text-center">
			<h1 class="text-4xl md:text-5xl font-bold text-white mb-6">
				Projects & Cases
			</h1>
			<p class="text-slate-400 text-lg max-w-2xl mx-auto">
				A selection of my most recent work, from deep technical
				optimizations to intelligent automations.
			</p>
		</header>

		<!-- React Island for Search/Filter -->
		<ProjectFilter client:load projects={optimizedProjects} />
	</div>
</Layout>
